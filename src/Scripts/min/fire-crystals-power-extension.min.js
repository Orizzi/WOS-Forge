!function(){"use strict";const t={};function e(){if(!window.FireCrystalsCalculator)return 0;let e=0;return["Furnace","Embassy","Command Center","Infirmary","Infantry Camp","Marksman Camp","Lancer Camp","War Academy"].forEach(n=>{const r=n.toLowerCase().replace(/ /g,"-"),o=document.getElementById(`${r}-finish`),i=function(e,n){const r=t[e];if(!r)return null;if(n&&null!=r[n])return r[n];const o=function(t){if(!t)return t;const e=t.match(/^FC\d+/i);return e?e[0].toUpperCase():"F30"===t.toUpperCase()||t.startsWith("30")?"30":t}(n);if(o&&null!=r[o])return r[o];const i=o&&o.toLowerCase();if(i){const t=Object.keys(r).find(t=>t.toLowerCase()===i);if(t)return r[t]}return null}(n,o&&o.value);null!=i&&(e+=i)}),e}function n(){const t=e(),n=document.getElementById("total-power-value");n&&(n.innerHTML=`<strong>${t>0?t.toLocaleString():"Data pending"}</strong>`)}function r(){if(!window.FireCrystalsCalculator||!window.FireCrystalsCalculator.calculateAll)return;const t=window.FireCrystalsCalculator.calculateAll;window.FireCrystalsCalculator.calculateAll=function(){t(),n()}}function o(){if(function(){try{if(window.BuildingPowerMap){let e=0;if(Object.keys(window.BuildingPowerMap).forEach(n=>{t[n]||(t[n]={}),Object.assign(t[n],window.BuildingPowerMap[n]),e+=Object.keys(window.BuildingPowerMap[n]).length}),e>0){console.info(`[FireCrystals Power] Inline map loaded ${e} entries.`),window.PowerDataStatus={loaded:!0,rows:e};try{window.dispatchEvent(new CustomEvent("power-csv-ready",{detail:{rows:e}}))}catch(t){}return!0}}}catch(t){}return!1}())return r(),void setTimeout(n,200);var e;(e="assets/building_power.csv",fetch(e,{cache:"no-cache"}).then(t=>t.ok?t.text():"").then(e=>{if(!e)return;const n=e.split(/\r?\n/).filter(t=>t.trim().length>0);if(n.length<2)return;const r=n[0].split(",").map(t=>t.trim().toLowerCase()),o=r.indexOf("building"),i=r.indexOf("level"),a=r.indexOf("power");if([o,i,a].some(t=>-1===t))return;let s=0;for(let e=1;e<n.length;e++){const r=n[e].split(","),l=r[o]?.trim(),c=r[i]?.trim(),u=parseInt(r[a],10);l&&c&&!isNaN(u)&&(t[l]||(t[l]={}),t[l][c]=u,s++)}if(s>0){console.info(`[FireCrystals Power] Loaded ${s} entries.`),window.PowerDataStatus={loaded:!0,rows:s};try{window.dispatchEvent(new CustomEvent("power-csv-ready",{detail:{rows:s}}))}catch(t){}}}).catch(()=>{})).then(()=>{r(),setTimeout(n,200)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}();