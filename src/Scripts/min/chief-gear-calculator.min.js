const chiefGearBatchInputs=Array.from(document.querySelectorAll('select[id$="-batch-from"], select[id$="-batch-to"]'));chiefGearBatchInputs.forEach(e=>{e.addEventListener("change",()=>{window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&ProfilesModule.autoSaveCurrentProfile()})});const ChiefGearCalculatorModule=function(){const e=["Locked","Green","Green 1","Blue","Blue 1","Blue 2","Blue 3","Purple","Purple 1","Purple 2","Purple 3","Purple T1","Purple T1 1","Purple T1 2","Purple T1 3","Gold","Gold 1","Gold 2","Gold 3","Gold T1","Gold T1 1","Gold T1 2","Gold T1 3","Gold T2","Gold T2 1","Gold T2 2","Gold T2 3","Red","Red 1","Red 2","Red 3","Red T1","Red T1 1","Red T1 2","Red T1 3","Red T2","Red T2 1","Red T2 2","Red T2 3","Red T3","Red T3 1","Red T3 2","Red T3 3","Red T4","Red T4 1","Red T4 2","Red T4 3"],t={Locked:"Locked",Uncommon:"Green","Uncommon (1-Star)":"Green 1",Rare:"Blue","Rare (1-Star)":"Blue 1","Rare (2-Star)":"Blue 2","Rare (3-Star)":"Blue 3",Epic:"Purple","Epic (1-Star)":"Purple 1","Epic (2-Star)":"Purple 2","Epic (3-Star)":"Purple 3","Epic T1":"Purple T1","Epic T1 (1-Star)":"Purple T1 1","Epic T1 (2-Star)":"Purple T1 2","Epic T1 (3-Star)":"Purple T1 3",Mythic:"Gold","Mythic (1-Star)":"Gold 1","Mythic (2-Star)":"Gold 2","Mythic (3-Star)":"Gold 3","Mythic T1":"Gold T1","Mythic T1 (1-Star)":"Gold T1 1","Mythic T1 (2-Star)":"Gold T1 2","Mythic T1 (3-Star)":"Gold T1 3","Mythic T2":"Gold T2","Mythic T2 (1-Star)":"Gold T2 1","Mythic T2 (2-Star)":"Gold T2 2","Mythic T2 (3-Star)":"Gold T2 3",Legendary:"Red","Legendary (1-Star)":"Red 1","Legendary (2-Star)":"Red 2","Legendary (3-Star)":"Red 3","Legendary T1":"Red T1","Legendary T1 (1-Star)":"Red T1 1","Legendary T1 (2-Star)":"Red T1 2","Legendary T1 (3-Star)":"Red T1 3","Legendary T2":"Red T2","Legendary T2 (1-Star)":"Red T2 1","Legendary T2 (2-Star)":"Red T2 2","Legendary T2 (3-Star)":"Red T2 3","Legendary T3":"Red T3","Legendary T3 (1-Star)":"Red T3 1","Legendary T3 (2-Star)":"Red T3 2","Legendary T3 (3-Star)":"Red T3 3","Legendary T4":"Red T4","Legendary T4 (1-Star)":"Red T4 1","Legendary T4 (2-Star)":"Red T4 2","Legendary T4 (3-Star)":"Red T4 3"},n={};Object.entries(t).forEach(([e,t])=>{n[t]||(n[t]=e)}),n.Locked="Locked";const r=["helmet","chestplate","ring","watch","pants","staff"],o={};function s(n){if(!n)return n;const r=n.trim();return e.includes(r)?r:t[r]||r}function l(e){const t=s(e);return n[t]||t}function a(e){return String(e||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(e,t){if(!e)return;const n=Array.isArray(t)&&t.length>0?t:[];if(0===n.length)return e.removeAttribute("data-level-regex"),void e.setCustomValidity("");const r=`^(${n.map(a).join("|")})$`;e.setAttribute("data-level-regex",r);const o=new RegExp(r),l=s(e.value);l&&!o.test(l)?e.setCustomValidity("Invalid range selected"):e.setCustomValidity("")}function d(t,n){if(t){const r=n?e.indexOf(s(n.value)):-1;i(t,-1===r?e.slice():e.slice(0,r+1))}if(n){const r=t?e.indexOf(s(t.value)):-1;i(n,-1===r?e.slice():e.slice(r))}}function c(e){if(window.IconHelper)return window.IconHelper.label(e,e=>e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," "));const t={"hardened-alloy":"assets/resources/chief-gear/hardened-alloy.png","polishing-solution":"assets/resources/chief-gear/polishing-solution.png","design-plans":"assets/resources/chief-gear/design-plans.png","lunar-amber":"assets/resources/chief-gear/lunar-amber.png"}[e];if(!t)return e;const n=e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," ");return`<img class="res-icon" src="${t}" alt="${n}" onerror="this.style.display='none'"> ${n}`}function u(e){const t=window.I18n?window.I18n.t:e=>e,n=t(e);if(window.IconHelper)return window.IconHelper.label(e,()=>t("total")+" "+n);const r={"hardened-alloy":"assets/resources/chief-gear/hardened-alloy.png","polishing-solution":"assets/resources/chief-gear/polishing-solution.png","design-plans":"assets/resources/chief-gear/design-plans.png","lunar-amber":"assets/resources/chief-gear/lunar-amber.png"}[e];return r?`<img class="res-icon" src="${r}" alt="${n}" onerror="this.style.display='none'"> ${t("total")} ${n}`:t("total")+" "+n}function g(t,n){const r=s(t),l=s(n),a=e.indexOf(r),i=e.indexOf(l);if(-1===a||-1===i||a>=i)return null;let d={hardenedAlloy:0,polishingSolution:0,designPlans:0,lunarAmber:0,power:0,svsPoints:0},c=null;for(let t=a+1;t<=i;t++){const n=e[t],r=o[n];r&&(d.hardenedAlloy+=r.hardenedAlloy,d.polishingSolution+=r.polishingSolution,d.designPlans+=r.designPlans,d.lunarAmber+=r.lunarAmber,d.svsPoints+=r.svsPoints,c=r)}return d.power=c&&c.power||0,d}function p(t,n){const r=t.value,o=n.value;if(!r&&o)return t.value=e[0],void d(t,n);if(!r||!o)return void d(t,n);const l=s(r),a=s(o),i=e.indexOf(l),c=e.indexOf(a);-1!==i&&-1!==c&&i>c&&(n.value=r),Array.from(n.options).forEach(t=>{if(!t.value)return;const n=e.indexOf(s(t.value));t.disabled=-1!==n&&-1!==i&&n<i}),d(t,n)}function f(e){return e.toLocaleString()}function h(){const e=document.getElementById("calculation-results");if(!e)return;const t=window.I18n?window.I18n.t:e=>e,n={hardenedAlloy:parseInt(document.getElementById("inventory-alloy")?.value)||0,polishingSolution:parseInt(document.getElementById("inventory-solution")?.value)||0,designPlans:parseInt(document.getElementById("inventory-plans")?.value)||0,lunarAmber:parseInt(document.getElementById("inventory-amber")?.value)||0},o=[];let s={hardenedAlloy:0,polishingSolution:0,designPlans:0,lunarAmber:0,power:0,svsPoints:0};r.forEach(e=>{const t=document.getElementById(`${e}-start`),n=document.getElementById(`${e}-finish`);if(!t||!n)return;const r=t.value,a=n.value;if(!r||!a)return;const i=g(r,a);i&&(o.push({name:e,from:r,fromDisplay:l(r),to:a,toDisplay:l(a),costs:i}),s.hardenedAlloy+=i.hardenedAlloy,s.polishingSolution+=i.polishingSolution,s.designPlans+=i.designPlans,s.lunarAmber+=i.lunarAmber,s.power+=i.power,s.svsPoints+=i.svsPoints)});const a=s.hardenedAlloy>0||s.polishingSolution>0||s.designPlans>0||s.lunarAmber>0;function i(e,n,r){const o=n-r;if(!a)return`\n          <div class="total-line">\n            <p><strong>${e}:</strong> ${f(n)}</p>\n          </div>`;const s=o>0?"deficit":"surplus",l=o>0?`⚠ ${t("need-more")} ${f(o)} ${t("more")}`:`✅ ${t("will-have")} ${f(Math.abs(o))} ${t("left")}`;return`\n        <div class="total-line">\n          <p><strong>${e}:</strong> ${f(n)}</p>\n          <div class="gap-line ${s}" aria-label="After inventory: ${l}">${l}</div>\n        </div>`}const d=`\n      <div class="result-totals" aria-live="polite">\n        ${i(u("hardened-alloy"),s.hardenedAlloy,n.hardenedAlloy)}\n        ${i(u("polishing-solution"),s.polishingSolution,n.polishingSolution)}\n        ${i(u("design-plans"),s.designPlans,n.designPlans)}\n        ${i(u("lunar-amber"),s.lunarAmber,n.lunarAmber)}\n        <p class="summary-pill power-pill" style="background: var(--accent-secondary); color: white;"><strong>${t("total-power")||"Total Power"}:</strong> ${f(s.power)}</p>\n        <p class="summary-pill svs-pill" style="background: var(--accent); color: white;"><strong>${t("total-svs-points")||"Total SvS Points"}:</strong> ${f(s.svsPoints)}</p>\n      </div>`;if(!a)return void(e.innerHTML=d);let p=`<div class="results-wrap table-responsive">\n        <table class="results-table">\n          <thead>\n            <tr>\n              <th>${t("slot")||"Slot"}</th>\n              <th>${t("from")||"FROM"}</th>\n              <th>${t("to")||"TO"}</th>\n              <th>${c("hardened-alloy")}</th>\n              <th>${c("polishing-solution")}</th>\n              <th>${c("design-plans")}</th>\n              <th>${c("lunar-amber")}</th>\n              <th>${t("power")||"Power"}</th>\n              <th>${t("svs-points")||"SvS Points"}</th>\n            </tr>\n          </thead>\n          <tbody>`;o.forEach(e=>{const n=t(e.name.charAt(0).toUpperCase()+e.name.slice(1))||e.name;p+=`<tr>\n          <td>${n}</td>\n          <td>${e.fromDisplay}</td>\n          <td>${e.toDisplay}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/hardened-alloy.png" alt=""> ${f(e.costs.hardenedAlloy)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/polishing-solution.png" alt=""> ${f(e.costs.polishingSolution)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/design-plans.png" alt=""> ${f(e.costs.designPlans)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/lunar-amber.png" alt=""> ${f(e.costs.lunarAmber)}</td>\n          <td>${f(e.costs.power)}</td>\n          <td>${f(e.costs.svsPoints)}</td>\n        </tr>`}),p+=`</tbody>\n          <tfoot>\n            <tr class="totals-row">\n              <td>${t("totals")||"Totals"}</td>\n              <td>&nbsp;</td>\n              <td>&nbsp;</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/hardened-alloy.png" alt=""> ${f(s.hardenedAlloy)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/polishing-solution.png" alt=""> ${f(s.polishingSolution)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/design-plans.png" alt=""> ${f(s.designPlans)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/lunar-amber.png" alt=""> ${f(s.lunarAmber)}</td>\n              <td>${f(s.power)}</td>\n              <td>${f(s.svsPoints)}</td>\n            </tr>\n          </tfoot>\n        </table>\n      </div>`,e.innerHTML=d+p,"undefined"!=typeof TableSortModule&&TableSortModule.makeTableSortable(document.querySelector(".results-table"))}function m(){Array.from(document.querySelectorAll('select[id$="-start"], select[id$="-finish"]')).filter(e=>!e.id.endsWith("-from")&&!e.id.endsWith("-to")).forEach(t=>{t.value=e[0]});Array.from(document.querySelectorAll('select[id$="-from"], select[id$="-to"]')).forEach(t=>{t.value=e[0]});Array.from(document.querySelectorAll('select[id$="-start"]')).filter(e=>!e.id.endsWith("-from")).forEach(e=>{const t=e.id.replace(/-start$/,""),n=document.getElementById(t+"-finish");n&&Array.from(n.options).forEach(e=>{e.disabled=!1})}),h(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}function y(e,t){const n=e=>{let n=e.target.value.replace(/\D/g,"");n.length>t&&(n=n.slice(0,t)),e.target.value=n};e.addEventListener("input",n),e.addEventListener("change",n),e.addEventListener("keyup",n)}function v(t,n){n&&(r.forEach(r=>{const o=document.getElementById(`${r}-start`),l=document.getElementById(`${r}-finish`);if(o&&l)if("from"===t){o.value=String(n);const t=e.indexOf(s(String(n))),r=e.indexOf(s(l.value));-1!==t&&-1!==r&&t>r&&(l.value=String(n)),p(o,l)}else{l.value=String(n),o.value||(o.value=e[0]);const t=e.indexOf(s(o.value)),r=e.indexOf(s(String(n)));-1!==t&&-1!==r&&t>r&&(o.value=String(n)),p(o,l)}}),h())}async function T(){await async function(t="assets/chief_gear_costs.csv"){try{const n=await fetch(t,{cache:"no-cache"});if(!n.ok)return;const r=(await n.text()).split(/\r?\n/).filter(e=>e.trim().length>0);if(0===r.length)return;const l=r[0].split(",").map(e=>e.trim().toLowerCase()).map(e=>e.replace(/\s+/g,"")),a=(...e)=>{for(const t of e){const e=t.replace(/\s+/g,"").toLowerCase(),n=l.indexOf(e);if(-1!==n)return n}return-1},i={level:a("gear level","level","gearlevel"),alloy:a("hardened alloy","hardenedalloy","alloy"),solution:a("polishing solution","polishingsolution","polish"),plans:a("design plans","designplans","plans"),amber:a("lunar amber","lunaramber","amber"),power:a("power"),svsPoints:a("svspoints","svs points","svspoints")};let d=0;for(let t=1;t<r.length;t++){const n=r[t].split(",");if(n.length<6)continue;const l=n[i.level]?.trim(),a=s(l);a&&e.includes(a)&&(o[a]={hardenedAlloy:parseFloat(n[i.alloy])||0,polishingSolution:parseFloat(n[i.solution])||0,designPlans:parseFloat(n[i.plans])||0,lunarAmber:parseFloat(n[i.amber])||0,power:parseFloat(n[i.power])||0,svsPoints:parseFloat(n[i.svsPoints])||0},d++)}d>0&&console.info(`[Chief Gear] Applied ${d} cost overrides from CSV.`)}catch(e){console.warn("[Chief Gear] CSV override skipped:",e.message||e)}}();const t=document.getElementById("chief-gear-reset");t&&t.addEventListener("click",m);const n=document.getElementById("gear-batch-from"),l=document.getElementById("gear-batch-to");n&&l&&(p(n,l),n.addEventListener("change",()=>{p(n,l),v("from",n.value),h(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}),l.addEventListener("change",()=>{p(n,l),v("to",l.value),h(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)})),r.forEach(e=>{const t=document.getElementById(`${e}-start`),n=document.getElementById(`${e}-finish`);t&&n&&(p(t,n),t.addEventListener("change",()=>{p(t,n)}),n.addEventListener("change",()=>{p(t,n)}))});const a=document.getElementById("inventory-alloy"),i=document.getElementById("inventory-solution"),d=document.getElementById("inventory-plans"),c=document.getElementById("inventory-amber");a&&y(a,7),i&&y(i,7),d&&y(d,6),c&&y(c,5),document.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.tagName.toLowerCase(),n=(e.type||"").toLowerCase();if("button"===t||"button"===n||"submit"===n||"reset"===n)return;if("1"===e.dataset.cgAutoUpdate)return;const r=()=>h();e.addEventListener("input",r),e.addEventListener("change",r),e.dataset.cgAutoUpdate="1"}),h(),console.info("[Chief Gear Calculator] Initialized")}return e.forEach((e,t)=>{if("Locked"===e)return void(o[e]={hardenedAlloy:0,polishingSolution:0,designPlans:0,lunarAmber:0,power:0,svsPoints:0});const n=Math.max(0,t-1),r=10*(n+1);o[e]={hardenedAlloy:r,polishingSolution:r,designPlans:Math.floor(n/2)+1,lunarAmber:Math.floor(n/6),power:0,svsPoints:100*(n+1)}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",T):T(),{calculateAll:h,resetGear:m,applyBatch:function(t,n,r){const o="from"===n?"-start":"-finish",s=document.getElementById(t+o);if(s){if(s.value=String(r),"to"===n){const n=document.getElementById(t+"-start");if(n){const t=e.indexOf(n.value),o=e.indexOf(r);-1!==t&&-1!==o&&t>o&&(n.value=String(r)),p(n,s)}}if("from"===n){const n=document.getElementById(t+"-finish");if(n){const t=e.indexOf(r),o=e.indexOf(n.value);-1!==t&&-1!==o&&t>o&&(n.value=String(r)),p(s,n)}}h(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}},sumCosts:g,validateLevels:p}}();window.ChiefGearCalculator=ChiefGearCalculatorModule;