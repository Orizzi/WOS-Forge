const chiefGearBatchInputs=Array.from(document.querySelectorAll('select[id$="-batch-from"], select[id$="-batch-to"]'));chiefGearBatchInputs.forEach(e=>{e.addEventListener("change",()=>{window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&ProfilesModule.autoSaveCurrentProfile()})});const ChiefGearCalculatorModule=function(){const e=["Green","Green 1","Blue","Blue 1","Blue 2","Blue 3","Purple","Purple 1","Purple 2","Purple 3","Purple T1","Purple T1 1","Purple T1 2","Purple T1 3","Gold","Gold 1","Gold 2","Gold 3","Gold T1","Gold T1 1","Gold T1 2","Gold T1 3","Gold T2","Gold T2 1","Gold T2 2","Gold T2 3","Red","Red 1","Red 2","Red 3","Red T1","Red T1 1","Red T1 2","Red T1 3","Red T2","Red T2 1","Red T2 2","Red T2 3","Red T3","Red T3 1","Red T3 2","Red T3 3","Red T4","Red T4 1","Red T4 2","Red T4 3"],n=["helmet","chestplate","ring","watch","pants","staff"],t={};function o(e){if(window.IconHelper)return window.IconHelper.label(e,e=>e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," "));const n={"hardened-alloy":"assets/resources/chief-gear/hardened-alloy.png","polishing-solution":"assets/resources/chief-gear/polishing-solution.png","design-plans":"assets/resources/chief-gear/design-plans.png","lunar-amber":"assets/resources/chief-gear/lunar-amber.png"}[e];if(!n)return e;const t=e.charAt(0).toUpperCase()+e.slice(1).replace(/-/g," ");return`<img class="res-icon" src="${n}" alt="${t}" onerror="this.style.display='none'"> ${t}`}function s(e){const n=window.I18n?window.I18n.t:e=>e,t=n(e);if(window.IconHelper)return window.IconHelper.label(e,()=>n("total")+" "+t);const o={"hardened-alloy":"assets/resources/chief-gear/hardened-alloy.png","polishing-solution":"assets/resources/chief-gear/polishing-solution.png","design-plans":"assets/resources/chief-gear/design-plans.png","lunar-amber":"assets/resources/chief-gear/lunar-amber.png"}[e];return o?`<img class="res-icon" src="${o}" alt="${t}" onerror="this.style.display='none'"> ${n("total")} ${t}`:n("total")+" "+t}function l(n,o){const s=e.indexOf(n),l=e.indexOf(o);if(-1===s||-1===l||s>=l)return null;let r={hardenedAlloy:0,polishingSolution:0,designPlans:0,lunarAmber:0,power:0,svsPoints:0};for(let n=s+1;n<=l;n++){const o=e[n],s=t[o];s&&(r.hardenedAlloy+=s.hardenedAlloy,r.polishingSolution+=s.polishingSolution,r.designPlans+=s.designPlans,r.lunarAmber+=s.lunarAmber,r.power+=s.power,r.svsPoints+=s.svsPoints)}return r}function r(n,t){const o=n.value,s=t.value;if(!o&&s)return void(n.value=e[0]);if(!o||!s)return;const l=e.indexOf(o),r=e.indexOf(s);-1!==l&&-1!==r&&l>r&&(t.value=o),Array.from(t.options).forEach(n=>{if(!n.value)return;const t=e.indexOf(n.value);n.disabled=-1!==t&&-1!==l&&t<l})}function a(e){return e.toLocaleString()}function i(){const e=document.getElementById("calculation-results");if(!e)return;const t=window.I18n?window.I18n.t:e=>e,r={hardenedAlloy:parseInt(document.getElementById("inventory-alloy")?.value)||0,polishingSolution:parseInt(document.getElementById("inventory-solution")?.value)||0,designPlans:parseInt(document.getElementById("inventory-plans")?.value)||0,lunarAmber:parseInt(document.getElementById("inventory-amber")?.value)||0},i=[];let d={hardenedAlloy:0,polishingSolution:0,designPlans:0,lunarAmber:0,power:0,svsPoints:0};n.forEach(e=>{const n=document.getElementById(`${e}-start`),t=document.getElementById(`${e}-finish`);if(!n||!t)return;const o=n.value,s=t.value;if(!o||!s)return;const r=l(o,s);r&&(i.push({name:e,from:o,to:s,costs:r}),d.hardenedAlloy+=r.hardenedAlloy,d.polishingSolution+=r.polishingSolution,d.designPlans+=r.designPlans,d.lunarAmber+=r.lunarAmber,d.power+=r.power,d.svsPoints+=r.svsPoints)});const c=d.hardenedAlloy>0||d.polishingSolution>0||d.designPlans>0||d.lunarAmber>0;function u(e,n,o){const s=n-o;if(!c)return`\n          <div class="total-line">\n            <p><strong>${e}:</strong> ${a(n)}</p>\n          </div>`;const l=s>0?"deficit":"surplus",r=s>0?`⚠ ${t("need-more")} ${a(s)} ${t("more")}`:`✅ ${t("will-have")} ${a(Math.abs(s))} ${t("left")}`;return`\n        <div class="total-line">\n          <p><strong>${e}:</strong> ${a(n)}</p>\n          <div class="gap-line ${l}" aria-label="After inventory: ${r}">${r}</div>\n        </div>`}const f=`\n      <div class="result-totals" aria-live="polite">\n        ${u(s("hardened-alloy"),d.hardenedAlloy,r.hardenedAlloy)}\n        ${u(s("polishing-solution"),d.polishingSolution,r.polishingSolution)}\n        ${u(s("design-plans"),d.designPlans,r.designPlans)}\n        ${u(s("lunar-amber"),d.lunarAmber,r.lunarAmber)}\n        <p class="summary-pill power-pill" style="background: var(--accent-secondary); color: white;"><strong>${t("total-power")||"Total Power"}:</strong> ${a(d.power)}</p>\n        <p class="summary-pill svs-pill" style="background: var(--accent); color: white;"><strong>${t("total-svs-points")||"Total SvS Points"}:</strong> ${a(d.svsPoints)}</p>\n      </div>`;if(!c)return void(e.innerHTML=f);let g=`<div class="results-wrap">\n        <table class="results-table">\n          <thead>\n            <tr>\n              <th>${t("slot")||"Slot"}</th>\n              <th>${t("from")||"FROM"}</th>\n              <th>${t("to")||"TO"}</th>\n              <th>${o("hardened-alloy")}</th>\n              <th>${o("polishing-solution")}</th>\n              <th>${o("design-plans")}</th>\n              <th>${o("lunar-amber")}</th>\n            </tr>\n          </thead>\n          <tbody>`;i.forEach(e=>{const n=t(e.name.charAt(0).toUpperCase()+e.name.slice(1))||e.name;g+=`<tr>\n          <td>${n}</td>\n          <td>${e.from}</td>\n          <td>${e.to}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/hardened-alloy.png" alt=""> ${a(e.costs.hardenedAlloy)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/polishing-solution.png" alt=""> ${a(e.costs.polishingSolution)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/design-plans.png" alt=""> ${a(e.costs.designPlans)}</td>\n          <td><img class="res-icon" src="assets/resources/chief-gear/lunar-amber.png" alt=""> ${a(e.costs.lunarAmber)}</td>\n        </tr>`}),g+=`</tbody>\n          <tfoot>\n            <tr class="totals-row">\n              <td colspan="3">${t("totals")||"Totals"}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/hardened-alloy.png" alt=""> ${a(d.hardenedAlloy)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/polishing-solution.png" alt=""> ${a(d.polishingSolution)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/design-plans.png" alt=""> ${a(d.designPlans)}</td>\n              <td><img class="res-icon" src="assets/resources/chief-gear/lunar-amber.png" alt=""> ${a(d.lunarAmber)}</td>\n            </tr>\n          </tfoot>\n        </table>\n      </div>`,e.innerHTML=f+g,"undefined"!=typeof TableSortModule&&TableSortModule.makeTableSortable(document.querySelector(".results-table"))}function d(){Array.from(document.querySelectorAll('select[id$="-start"], select[id$="-finish"]')).filter(e=>!e.id.endsWith("-from")&&!e.id.endsWith("-to")).forEach(e=>{e.value=""});Array.from(document.querySelectorAll('select[id$="-from"], select[id$="-to"]')).forEach(e=>{e.value=""});Array.from(document.querySelectorAll('select[id$="-start"]')).filter(e=>!e.id.endsWith("-from")).forEach(e=>{const n=e.id.replace(/-start$/,""),t=document.getElementById(n+"-finish");t&&Array.from(t.options).forEach(e=>{e.disabled=!1})}),i(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}function c(e,n){const t=e=>{let t=e.target.value.replace(/\D/g,"");t.length>n&&(t=t.slice(0,n)),e.target.value=t};e.addEventListener("input",t),e.addEventListener("change",t),e.addEventListener("keyup",t)}function u(t,o){o&&(n.forEach(n=>{const s=document.getElementById(`${n}-start`),l=document.getElementById(`${n}-finish`);if(s&&l)if("from"===t){s.value=String(o);const n=e.indexOf(String(o)),t=e.indexOf(l.value);-1!==n&&-1!==t&&n>t&&(l.value=String(o)),r(s,l)}else{l.value=String(o),s.value||(s.value=e[0]);const n=e.indexOf(s.value),t=e.indexOf(String(o));-1!==n&&-1!==t&&n>t&&(s.value=String(o)),r(s,l)}}),i())}async function f(){await async function(n="assets/chief_gear_costs.csv"){try{const o=await fetch(n,{cache:"no-cache"});if(!o.ok)return;const s=(await o.text()).split(/\r?\n/).filter(e=>e.trim().length>0);if(0===s.length)return;const l=s[0].split(",").map(e=>e.trim().toLowerCase()),r={level:l.indexOf("gear level")>=0?l.indexOf("gear level"):l.indexOf("level"),alloy:l.indexOf("hardened alloy")>=0?l.indexOf("hardened alloy"):l.indexOf("hardenedalloy"),solution:l.indexOf("polishing solution")>=0?l.indexOf("polishing solution"):l.indexOf("polishingsolution"),plans:l.indexOf("design plans")>=0?l.indexOf("design plans"):l.indexOf("designplans"),amber:l.indexOf("lunar amber")>=0?l.indexOf("lunar amber"):l.indexOf("lunaramber"),power:l.indexOf("power"),svsPoints:l.indexOf("svspoints")>=0?l.indexOf("svspoints"):l.indexOf("svs points")};let a=0;for(let n=1;n<s.length;n++){const o=s[n].split(",");if(o.length<6)continue;const l=o[r.level]?.trim();l&&e.includes(l)&&(t[l]={hardenedAlloy:parseFloat(o[r.alloy])||0,polishingSolution:parseFloat(o[r.solution])||0,designPlans:parseFloat(o[r.plans])||0,lunarAmber:parseFloat(o[r.amber])||0,power:parseFloat(o[r.power])||0,svsPoints:parseFloat(o[r.svsPoints])||0},a++)}a>0&&console.info(`[Chief Gear] Applied ${a} cost overrides from CSV.`)}catch(e){console.warn("[Chief Gear] CSV override skipped:",e.message||e)}}();const o=document.getElementById("chief-gear-reset");o&&o.addEventListener("click",d);const s=document.getElementById("gear-batch-from"),l=document.getElementById("gear-batch-to");s&&l&&(r(s,l),s.addEventListener("change",()=>{r(s,l),u("from",s.value),i(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}),l.addEventListener("change",()=>{r(s,l),u("to",l.value),i(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)})),n.forEach(e=>{const n=document.getElementById(`${e}-start`),t=document.getElementById(`${e}-finish`);n&&t&&(r(n,t),n.addEventListener("change",()=>{r(n,t),i()}),t.addEventListener("change",()=>{r(n,t),i()}))});const a=document.getElementById("inventory-alloy"),f=document.getElementById("inventory-solution"),g=document.getElementById("inventory-plans"),h=document.getElementById("inventory-amber");a&&(c(a,7),a.addEventListener("input",i),a.addEventListener("change",i)),f&&(c(f,7),f.addEventListener("input",i),f.addEventListener("change",i)),g&&(c(g,6),g.addEventListener("input",i),g.addEventListener("change",i)),h&&(c(h,5),h.addEventListener("input",i),h.addEventListener("change",i)),i(),console.info("[Chief Gear Calculator] Initialized")}return e.forEach((e,n)=>{const o=10*(n+1);t[e]={hardenedAlloy:o,polishingSolution:o,designPlans:Math.floor(n/2)+1,lunarAmber:Math.floor(n/6),power:0,svsPoints:100*(n+1)}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f(),{calculateAll:i,resetGear:d,applyBatch:function(n,t,o){const s="from"===t?"-start":"-finish",l=document.getElementById(n+s);if(l){if(l.value=String(o),"to"===t){const t=document.getElementById(n+"-start");if(t){const n=e.indexOf(t.value),s=e.indexOf(o);-1!==n&&-1!==s&&n>s&&(t.value=String(o)),r(t,l)}}if("from"===t){const t=document.getElementById(n+"-finish");if(t){const n=e.indexOf(o),s=e.indexOf(t.value);-1!==n&&-1!==s&&n>s&&(t.value=String(o)),r(l,t)}}i(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&setTimeout(()=>{ProfilesModule.autoSaveCurrentProfile()},0)}},sumCosts:l,validateLevels:r}}();window.ChiefGearCalculator=ChiefGearCalculatorModule;