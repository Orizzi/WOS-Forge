!function(){const e={submitting:!1,cooldownTimer:null},t=e=>e.trim().replace(/[^\dA-Za-z]/g,""),n=(e,t,n="info")=>{e&&(e.textContent=t,e.dataset.status=n)},o=(e,t,n="info")=>{if(!e)return;const o=document.createElement("li");o.textContent=t,o.className=`gift-code-log__item ${n}`,e.prepend(o)},s=e=>{e&&(e.innerHTML="")},r=(e,n)=>{const o=[];var s;return e&&e.value.trim()&&o.push(e.value.trim()),n&&n.value.trim()&&o.push(...(s=n.value,s.split(/[\s,]+/).map(e=>e.trim()).filter(Boolean))),(e=>{const t=new Set;return e.filter(e=>!t.has(e)&&(t.add(e),!0))})(o.map(t)).filter(Boolean)},a=async({playerId:e,giftCode:t,note:n})=>{try{const o=await fetch("https://wos-forge.vercel.app/api/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:e,giftCode:t,note:n||void 0})});let s;if((o.headers.get("content-type")||"").includes("application/json"))s=await o.json();else{const e=await o.text();s=e?{message:e}:{}}const r=((e,t)=>e?.message||e?.msg||e?.error||t||"Unknown response")(s,o.ok?`Gift code sent to player ${e}`:`Request failed with status ${o.status}`),a=((e,t)=>{const n=e?.wait??e?.retryAfter??e?.retry_after??(t?.headers?.get?t.headers.get("retry-after"):void 0);return"number"==typeof n?n:n?Number(n):void 0})(s,o);return{success:o.ok&&(void 0===s?.success||!0===s.success||"ok"===s?.status),message:r,waitSeconds:a,status:o.status}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Network error occurred"}}};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("gift-code-form");if(!t)return;const i=document.getElementById("gift-player-id"),d=document.getElementById("gift-player-ids"),c=document.getElementById("gift-code-input"),l=document.getElementById("gift-note"),u=document.querySelector(".gift-code-status-text"),m=document.getElementById("gift-code-log"),g=document.getElementById("gift-code-submit");c&&g&&(t.addEventListener("submit",async t=>{if(t.preventDefault(),e.submitting)return;const f=r(i,d),p=c.value.trim().toUpperCase(),y=l?.value.trim()||"";if(!p)return void n(u,"Enter the gift code you want to redeem.","warn");if(!f.length)return void n(u,"Add at least one player ID.","warn");var w;s(m),(w=g)&&(e.submitting=!0,w.dataset.originalLabel||(w.dataset.originalLabel=w.textContent),w.disabled=!0,w.textContent="Redeeming..."),n(u,`Redeeming ${p} for ${f.length} player(s)...`,"info");let b=0,h=0,v=!1;for(let e=0;e<f.length;e+=1){const t=f[e];n(u,`Redeeming ${p}: ${e+1}/${f.length} in progress...`,"info");const s=await a({playerId:t,giftCode:p,note:y});if(s.success){b+=1,o(m,`[OK] Gift code sent to ${t}`,"success");continue}h+=1;const r="number"==typeof s.waitSeconds?` Please wait ${Math.ceil(s.waitSeconds)} seconds before retrying.`:"",i=429===s.status||s.waitSeconds?"rate":"error";if(o(m,`[ERR] ${t}: ${s.message}${r}`,i),"rate"===i){v=!0,n(u,s.message||"Rate limit reached. Please wait a bit before trying again.","warn");break}}if(!v){const e=`${b}/${f.length} players redeemed. Errors: ${h}.`;n(u,h?`${e} Check the log for details.`:e,h?"warn":"success")}(t=>{t&&(t.disabled=!1,t.textContent=t.dataset.originalLabel||"Redeem",e.submitting=!1)})(g),(t=>{t&&(e.cooldownTimer&&window.clearTimeout(e.cooldownTimer),t.disabled=!0,e.cooldownTimer=window.setTimeout(()=>{e.submitting||(t.disabled=!1)},4e3))})(g)}),t.addEventListener("reset",()=>{s(m),n(u,"Provide at least one player ID and a gift code to redeem.","info")}))})}();