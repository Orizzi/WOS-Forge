const PetsCalculatorModule=function(){"use strict";const e={},s={"cave-hyena":"Cave Hyena","arctic-wolf":"Arctic Wolf","musk-ox":"Musk Ox","giant-tapir":"Giant Tapir","titan-roc":"Titan Roc","giant-elk":"Giant Elk","snow-leopard":"Snow Leopard","cave-lion":"Cave Lion","snow-ape":"Snow Ape","iron-rhino":"Iron Rhino","sabertooth-tiger":"Sabertooth Tiger",mammoth:"Mammoth","frost-gorilla":"Frost Gorilla","frostscale-chameleon":"Frostscale Chameleon","abyssal-shelldragon":"Abyssal Shelldragon"};(-1).toString();function t(s,t,o){const n={foodBase:0,foodRequired:0,manualBase:0,manualRequired:0,potionBase:0,potionRequired:0,serumBase:0,serumRequired:0,svsPointsBase:0,svsPointsRequired:0};if(!e[s])return console.warn(`[Pets] Unknown pet: ${s}`),n;const a=parseFloat(t),r=parseFloat(o);if(isNaN(a)||isNaN(r)||a>=r)return n;const i=Object.keys(e[s]).map(e=>parseFloat(e)).filter(e=>e>a&&e<=r).sort((e,s)=>e-s);for(const t of i){const o=e[s][t];o&&(n.foodBase+=o.foodBase,n.foodRequired+=o.foodRequired,n.manualBase+=o.manualBase,n.manualRequired+=o.manualRequired,n.potionBase+=o.potionBase,n.potionRequired+=o.potionRequired,n.serumBase+=o.serumBase,n.serumRequired+=o.serumRequired,n.svsPointsBase+=o.svsPointsBase,n.svsPointsRequired+=o.svsPointsRequired)}return n}function o(){const e=document.getElementById("pets-results-display");if(!e)return void console.warn("[Pets] Results display not found");const o={foodBase:0,manualBase:0,potionBase:0,serumBase:0,svsPointsBase:0};Object.entries(s).forEach(([e,s])=>{const n=document.getElementById(`${e}-start`),a=document.getElementById(`${e}-finish`);if(!n||!a)return;const r=n.value,i=a.value;if(""===r||""===i||r===i)return;const l=t(s,r,i);o.foodBase+=l.foodBase,o.manualBase+=l.manualBase,o.potionBase+=l.potionBase,o.serumBase+=l.serumBase,o.svsPointsBase+=l.svsPointsBase});const n=parseInt(document.getElementById("inventory-food")?.value||"0",10),a=parseInt(document.getElementById("inventory-manual")?.value||"0",10),r=parseInt(document.getElementById("inventory-potion")?.value||"0",10),i=parseInt(document.getElementById("inventory-serum")?.value||"0",10),l=parseInt(document.getElementById("inventory-svs-points")?.value||"0",10),u=o.foodBase-n,d=o.manualBase-a,c=o.potionBase-r,m=o.serumBase-i,p=o.svsPointsBase-l,f=window.I18n?.t||(e=>e),v=o.foodBase>0||o.manualBase>0;function B(e){return`<span class="gap ${e>0?"deficit":"surplus"}">${e>0?`⚠ Need ${e.toLocaleString()} more`:`✅ Have ${Math.abs(e).toLocaleString()} left`}</span>`}function y(e){if(window.IconHelper&&"function"==typeof window.IconHelper.label)return window.IconHelper.label(e,f);const s={"food-base":"assets/resources/pet-items/food.png","manual-base":"assets/resources/pet-items/manual.png","potion-base":"assets/resources/pet-items/potion.png","serum-base":"assets/resources/pet-items/serum.png","svs-points-base":"assets/resources/base/svs-points.png"}[e],t=f(e);return s?`<img class="res-icon" src="${s}" alt="${t}" onerror="this.style.display='none'"> ${t}`:t}let g='<div class="totals-summary">';g+=`<div class="total-item"><span class="resource-label">${y("food-base")}:</span><span class="resource-value">${o.foodBase.toLocaleString()}</span>${v?B(u):""}</div>`,g+=`<div class="total-item"><span class="resource-label">${y("manual-base")}:</span><span class="resource-value">${o.manualBase.toLocaleString()}</span>${v?B(d):""}</div>`,g+=`<div class="total-item"><span class="resource-label">${y("potion-base")}:</span><span class="resource-value">${o.potionBase.toLocaleString()}</span>${v?B(c):""}</div>`,g+=`<div class="total-item"><span class="resource-label">${y("serum-base")}:</span><span class="resource-value">${o.serumBase.toLocaleString()}</span>${v?B(m):""}</div>`,g+=`<div class="total-item"><span class="resource-label">${y("svs-points-base")}:</span><span class="resource-value">${o.svsPointsBase.toLocaleString()}</span>${v?B(p):""}</div>`,g+="</div>",e.innerHTML=g}function n(){document.querySelectorAll('[id$="-start"], [id$="-finish"]').forEach(e=>{e.addEventListener("change",()=>{o(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&ProfilesModule.autoSaveCurrentProfile()})});document.querySelectorAll("#inventory-food, #inventory-manual, #inventory-potion, #inventory-serum, #inventory-svs-points").forEach(e=>{e.addEventListener("change",()=>{window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&ProfilesModule.autoSaveCurrentProfile()})});const e=document.getElementById("pets-reset");e&&e.addEventListener("click",a),function(){const e=["","10","10.1","20","20.1","30","30.1","40","40.1","50","50.1","60","60.1","70","70.1","80","80.1","90","90.1","100","100.1"];Object.keys(s).forEach(s=>{const t=document.getElementById(`${s}-start`),o=document.getElementById(`${s}-finish`);t&&t.options.length<=1&&e.forEach(e=>{const s=document.createElement("option");s.value=e,s.textContent=e||"--",t.appendChild(s)}),o&&o.options.length<=1&&e.forEach(e=>{const s=document.createElement("option");s.value=e,s.textContent=e||"--",o.appendChild(s)})})}(),o()}function a(){Object.keys(s).forEach(e=>{const s=document.getElementById(`${e}-start`),t=document.getElementById(`${e}-finish`);s&&(s.value=""),t&&(t.value="")});["inventory-food","inventory-manual","inventory-potion","inventory-serum","inventory-svs-points"].forEach(e=>{const s=document.getElementById(e);s&&(s.value="0")}),o(),window.ProfilesModule&&ProfilesModule.autoSaveCurrentProfile&&ProfilesModule.autoSaveCurrentProfile()}function r(){const e={};Object.entries(s).forEach(([s,t])=>{const o=document.getElementById(`${s}-start`),n=document.getElementById(`${s}-finish`);o&&(e[`${s}-start`]=o.value),n&&(e[`${s}-finish`]=n.value)});return["inventory-food","inventory-manual","inventory-potion","inventory-serum","inventory-svs-points"].forEach(s=>{const t=document.getElementById(s);t&&(e[s]=t.value)}),e}function i(e){if(!e||"object"!=typeof e)return;Object.entries(s).forEach(([s,t])=>{const o=`${s}-start`,n=`${s}-finish`;if(void 0!==e[o]){const s=document.getElementById(o);s&&(s.value=e[o])}if(void 0!==e[n]){const s=document.getElementById(n);s&&(s.value=e[n])}});["inventory-food","inventory-manual","inventory-potion","inventory-serum","inventory-svs-points"].forEach(s=>{if(void 0!==e[s]){const t=document.getElementById(s);t&&(t.value=e[s])}}),o()}return console.info("[Pets] Initializing calculator module"),function(){const t=Object.values(s),o=[10,10.1,20,20.1,30,30.1,40,40.1,50,50.1,60,60.1,70,70.1,80,80.1,90,90.1,100,100.1];t.forEach(s=>{e[s]={},o.forEach(t=>{e[s][t]={foodBase:0,foodRequired:0,manualBase:0,manualRequired:0,potionBase:0,potionRequired:0,serumBase:0,serumRequired:0,svsPointsBase:0,svsPointsRequired:0}})})}(),async function(s="assets/pets_costs.csv"){try{const t=await fetch(s,{cache:"no-cache"});if(!t.ok)return void console.warn("[Pets] CSV not found, using fallback defaults");const o=(await t.text()).split(/\r?\n/).filter(e=>e.trim().length>0);if(o.length<=1)return void console.warn("[Pets] CSV empty or no data rows");const n=o[0].split(",").map(e=>e.trim().toLowerCase()),a={petName:n.indexOf("petname"),level:n.indexOf("level"),foodBase:n.indexOf("foodbase"),foodRequired:n.indexOf("foodrequired"),manualBase:n.indexOf("manualbase"),manualRequired:n.indexOf("manualrequired"),potionBase:n.indexOf("potionbase"),potionRequired:n.indexOf("potionrequired"),serumBase:n.indexOf("serumbase"),serumRequired:n.indexOf("serumrequired"),svsPointsBase:n.indexOf("svspointsbase"),svsPointsRequired:n.indexOf("svspointsrequired")},r=Object.entries(a).filter(([e,s])=>-1===s).map(([e])=>e);if(r.length>0)return void console.error("[Pets] Missing CSV columns:",r.join(", "));let i=0;const l=new Set;for(let s=1;s<o.length;s++){const t=(o[s].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[]).map(e=>e.replace(/^"|"$/g,"").trim());if(t.length<3)continue;const n=t[a.petName],r=parseFloat(t[a.level]);n&&!isNaN(r)&&(e[n]||(e[n]={},l.add(n)),e[n][r]={foodBase:parseInt(t[a.foodBase],10)||0,foodRequired:parseInt(t[a.foodRequired],10)||0,manualBase:parseInt(t[a.manualBase],10)||0,manualRequired:parseInt(t[a.manualRequired],10)||0,potionBase:parseInt(t[a.potionBase],10)||0,potionRequired:parseInt(t[a.potionRequired],10)||0,serumBase:parseInt(t[a.serumBase],10)||0,serumRequired:parseInt(t[a.serumRequired],10)||0,svsPointsBase:parseInt(t[a.svsPointsBase],10)||0,svsPointsRequired:parseInt(t[a.svsPointsRequired],10)||0},i++)}console.info(`[Pets] Applied ${i} cost overrides from CSV (${l.size} pets)`)}catch(e){console.warn("[Pets] CSV override skipped:",e.message)}}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.WOSCalcCore&&"function"==typeof window.WOSCalcCore.registerAdapter&&window.WOSCalcCore.registerAdapter({id:"pets",isActive:()=>!!document.getElementById("cave-hyena-start"),run:()=>o(),getCurrentState:()=>r(),loadState:e=>i(e)}),{calculateAll:o,sumCosts:t,getCurrentState:r,loadState:i,resetAll:a,getAvailablePets:function(){return Object.values(s)},getAvailableLevels:function(s){return e[s]?Object.keys(e[s]).map(e=>parseFloat(e)).sort((e,s)=>e-s):[]}}}();window.PetsCalculatorModule=PetsCalculatorModule;
//# sourceMappingURL=pets-calculator.min.js.map